import streamlit as st
from agents.marketing.video_pipeline.full_video_pipeline import generate_ai_video
import os
from datetime import datetime
import uuid

st.set_page_config(page_title="SportSync Dashboard", layout="centered")

# =========================
# â›³ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
# =========================
st.title("ğŸ SportSync AI â€“ Dashboard Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø°ÙƒÙŠØ©")
st.markdown("Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹ Ù‡Ø°Ø§ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù…Ø´Ø±ÙˆØ¹ÙƒØŒ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ÙƒÙˆØ¯ Ø£Ùˆ Ù…Ù„ÙØ§Øª.")

# =========================
# ğŸ§  Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… / Ø§Ù„ÙÙƒØ±Ø©
# =========================
st.subheader("1. Ø£Ø¯Ø®Ù„ ÙÙƒØ±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:")
user_input = st.text_area("ğŸ¯ Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø© Ø£Ùˆ Ø£Ù„ØµÙ‚ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", height=150)

# =========================
# ğŸŒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ©
# =========================
lang = st.selectbox("ğŸŒ Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:", ["en", "arabic"])

# =========================
# ğŸ“¹ Ù†ÙˆØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
# =========================
video_type = st.radio("ğŸ¬ Ù†ÙˆØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:", ["ğŸ Ù…Ù‚Ø·Ø¹ Ø·ÙˆÙŠÙ„", "ğŸ¯ Ø§Ù‚ØªØ¨Ø§Ø³ Ù‚ØµÙŠØ±", "ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù† ØªØ¬Ø±ÙŠØ¨ÙŠ"])

# =========================
# ğŸš€ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
# =========================
if st.button("ğŸš€ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¢Ù†"):
    if not user_input or not str(user_input).strip():
        st.warning("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙÙƒØ±Ø© Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹.")
    else:
        with st.spinner("Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ... â³"):
            full_text = user_input if isinstance(user_input, str) else str(user_input)

            user_data = {
                "full_text": full_text,
                "answers": {},
                "video_type": video_type  # âœ… ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù‡Ù†Ø§
            }

            try:
                video_path = generate_ai_video(user_data, lang=lang)
                st.success("âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!")
                st.video(video_path)
                st.markdown(f"ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø±: {video_path}")
            except Exception as e:
                st.error(f"âŒ Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆÙ„ÙŠØ¯: {e}")

# =========================
# ğŸ“ˆ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
# =========================
with st.expander("ğŸ“Š Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø¯Ø§Ø¡ ÙˆØªØ­Ù„ÙŠÙ„"):
    st.markdown("""
    - ğŸ“ˆ Ø§Ù„Ø£ÙØ¶Ù„ Ø£Ø¯Ø§Ø¡Ù‹: ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¨ØªÙˆÙ‚ÙŠØª 8:00 PM
    - ğŸ§  Ù†Ø¨Ø±Ø© [Ø«Ù‚Ø© + Ù‡Ø¯ÙˆØ¡] ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„
    - ğŸ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„Ù†Ø§Ø¬Ø­Ø©: inner drive, mental athlete, deep identity
    """)

# =========================
# ğŸ§° Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù‚Ø±ÙŠØ¨Ù‹Ø§)
# =========================
st.sidebar.title("ğŸ§° Ø£Ø¯ÙˆØ§Øª Ù‚Ø§Ø¯Ù…Ø©")
st.sidebar.info("ğŸš§ Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ ÙˆØ­Ø¯Ø© Ø§Ù„Ù†Ø´Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ + ØªØ¯Ø±ÙŠØ¨ Ø§Ù„ØµÙˆØª Ø§Ù„Ø´Ø®ØµÙŠ")
